
xsvftool-xpcu - An (X)SVF player for the Xilinx Platform Cable USB
==================================================================

This program can be used to play SVF and XSVF files on the "Xilinx
Platform Cable USB" family of JTAG probes.

It is based on the libxsvf library:
http://www.clifford.at/libxsvf/

This tool replaces the original CPLD firmware from Xilinx when run
on one of the probes. See the notes below on how to restore the xilinx
firmware on the CPLD.

The file 'firmware.c' also contains a brief description of the pin mappings
between the the Cypress CY7C68013A-100AIX and the Xilinx XC2C256-7VQ100
on the probe as used by this software, as well as a brief description of
the USB protocol this software is using.

With this software it is possible to use JTAG clock speeds up to 24 MHz.
But with the high frequencies there are "gaps" in the transmittion resulting
in an effective transfer rate of approx 6 MBit/s.

This tool contains firmware for the CY7C68013A-100AIX (firmware.c) and for the
XC2C256-7VQ100 (hardware.v) on the probe. Some more exotic tools are needed to
build these. So pre-compiled versions of this firmware images are distributed
along with the xsvftool-xpcu sourcecode. You need to set the USE_PREP_* config
options in the Makefile to '0' if you prefer building the firmware yourself.


Hardware Tested
---------------

Currently the only hardware that has been tested is a self-built clone of
the Xilinx probe, based on the schematics of a Xilinx development board.

It is possible that other probes need small modifications of the code in
order to work properly.

I plan to make some tests with other hardware soon...


Notes on device permissions
---------------------------

To run xsvftool-xpcu as unprivileged user you need to set the permissions on
the usb device accordingly. E.g.:

	$ lsusb -d 04b4:8613
	Bus 002 Device 021: ID 04b4:8613 Cypress Semiconductor Corp.  CY7C68013 EZ-USB FX2 USB 2.0 Development Kit

	$ sudo chmod 0666 /dev/bus/usb/002/021

	$ ./xsvftool-xpcu -Pc
	Scanning JTAG chain..
	idcode=0x16d4a093, revision=0x1, part=0x6d4a, manufactor=0x049
	Total number of JTAG clock cycles performed: 79
	READY.

Instead of doing this manually each time the device is connected one might
prefer to create a udev rule that does set the permissions automatically:

	$ vi /etc/udev/rules.d/xsvftool-xpcu.rules
	# Allow everyone access to the Xilinx Platform Cable USB (see 'man 7 udev' for details)
	ACTION=="add", SUBSYSTEM=="usb", ATTR{idVendor}=="04b4", ATTR{idProduct}=="8613", MODE:="0666"


Restore Xilinx CPLD Firmware
----------------------------

Up to ISE 11 the Xilinx "impact" program did automatically reprogram the CPLD on
the probe whenever needed. Since ISE 12 this does only work when there is already
an (older) Xilinx firmware on the probe. So in order to reprogram the CPLD on
the probe you need ISE 11 installed. Then it is prossible to reprogram the CPLD
just by loading the fx2 firmware and running impact on the probe:

	$ lsusb -d 04b4:8613
	Bus 002 Device 021: ID 04b4:8613 Cypress Semiconductor Corp.  CY7C68013 EZ-USB FX2 USB 2.0 Development Kit

	$ sudo ./xsvftool-xpcu -E

	$ sudo fxload -t fx2 -D /dev/bus/usb/002/021 -I /opt/Xilinx/11.3/ISE/bin/lin/xusb_emb.hex

	$ lsusb -d 03fd:0008
	Bus 002 Device 022: ID 03fd:0008 Xilinx, Inc. 

	$ sudo chmod 666 /dev/bus/usb/002/022

	$ vi impatch_batch.cmd
	setMode -bs
	setCable -port usb21
	identify	

	$ /opt/Xilinx/11.3/ISE/bin/lin/impact -batch impatch_batch.cmd

The "reset-probe.sh" shell script in this directory (libxsvf/xsvftool-xpcu.src/)
does this automatically:

	$ sudo bash reset-probe.sh

